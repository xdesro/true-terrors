---
layout: "layouts/base.njk"
bodyClass: "article"
---
{% from '../article-block.njk' import articleBlock %}
{% set nextPost = collections.article | getNextCollectionItem %}
{% set prevPost = collections.article | getPreviousCollectionItem %}

<header class="article-header">
    <div class="article-header__inner container">
    <div class="article-header__mast">
        <p class="article-header__category">{{ category }}</p>
        <h1 class="article-header__title" @text="title">{{ title }}</h1>
        <dl class="article-header__meta">
            <div>
                <dt>Duration</dt>
                <dd>{{ content | readTime }}</dd>
            </div>
            <div>
                <dt>Last Updated</dt>
                <dd>
                    {{ (publishDate or page.date) | monthYearDate }}
                </dd>
            </div>
            <div class="article-header__topics" webc:if="topics">
                <dt>Topics</dt>
                <dd @text="topics.join(' â€” ')">
                    <ul class="article-header__topics-list" role="list">
                    {%- for topic in topics -%}
                        <li>{{ topic }}</li>
                    {%- endfor -%}
                    </ul>
                </dd>
            </div>
        </dl>
    </div>
    {% if hasToc %}
        {% set toc = content | getTOC %}
        {% include 'table-of-contents.njk' %}
    {% endif %}
    {% if hasHero %}
        <div class="article-header__graphic-wrapper">
            {% if useHero %}
            <img alt="" {% if customThreshold %}data-threshold="{{ customThreshold }}"{% endif %} src="{{ heroImage }}" class="article-header__image">
            {% else %}
            <img alt="" src="/img/milan-cover-photo.jpg" class="article-header__image">
            {% endif %}
        </div>
    {% endif %}
</header>

<article class="article-content rendered">
    {{ content | safe }}
</article>

<div class="container">
{% set publicUrl = "https://henry.codes"  + page.url %}

{% if webmentions %}
    {% set filteredMentions = webmentions | webmentionsByUrl(publicUrl) %}
{% endif %}
{% if filteredMentions %}
    {% set likes = filteredMentions | getLikes %}
    {% set replies = filteredMentions | getReplies %}
    <section>
    <style>
    .profile-pic {
        border-radius: 100%;
        aspect-ratio: 1;
        max-width: 2rem;
    }
    </style>
        <h2>Webmentions</h2>
        {% if likes %}
        <section>
            <h3>Liked by:</h3>
            {% for like in likes %}
            <a href="{{ like.author.url }}">
                <img class="profile-pic" src="{{ like.author.photo }}" alt=""  eleventy:ignore/>
            </a>
            {% endfor %}
        </section>
        {% endif %}
        {% if replies %}
        <section>
            <h3>Replies:</h3>
            {% for reply in replies %}
            <article>
                <header>
                    <img class="profile-pic" src="{{ reply.author.photo }}" alt=""  eleventy:ignore/>
                    <h1>{{ reply.author.name }}</h1>
                    <a href="{{ reply.author.url }}">Go to profile</a>
                </header>
                <div>{{ reply.content.html | safe}}</div>
                <a href="{{ reply.url }}">Go to reply</a>
            </article>
            {% endfor %}
        </section>
        {% endif %}
    </section>
    {% endif %}
</div>

{% if nextPost or prevPost %}
    <!-- TODO: Next post doesn't work with webC -->
    <aside class="further-reading container">
        <h2>Try this next</h2>
        {% if nextPost %}
            {{ articleBlock(nextPost) }}
        {% else %}
            {{ articleBlock(prevPost) }}
        {% endif %}
    </aside>
{% endif %}
